{"version":3,"file":"app_config_privacy_compliance_webhooks.js","sourceRoot":"","sources":["../../../../../src/cli/models/extensions/specifications/app_config_privacy_compliance_webhooks.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,aAAa,EAAC,MAAM,yBAAyB,CAAA;AAErD,OAAO,EAA6B,kCAAkC,EAAC,MAAM,qBAAqB,CAAA;AAClG,OAAO,EAAC,YAAY,EAAC,MAAM,gCAAgC,CAAA;AAE3D,MAAM,yCAAyC,GAA+B;IAC5E,OAAO,EAAE,CAAC,OAAe,EAAE,EAAE,CAAC,0CAA0C,CAAC,OAAO,CAAC;IACjF,OAAO,EAAE,CAAC,OAAe,EAAE,EAAE,CAAC,4CAA4C,CAAC,OAAO,CAAC;CACpF,CAAA;AAED,MAAM,CAAC,MAAM,wCAAwC,GAAG,6BAA6B,CAAA;AAErF,2GAA2G;AAC3G,MAAM,IAAI,GAAG,kCAAkC,CAAC;IAC9C,UAAU,EAAE,wCAAwC;IACpD,MAAM,EAAE,aAAa;IACrB,eAAe,EAAE,yCAAyC;CAC3D,CAAC,CAAA;AAEF,eAAe,IAAI,CAAA;AAEnB,SAAS,0CAA0C,CAAC,OAAe;IACjE,MAAM,QAAQ,GAAG,YAAY,CAAC,OAAO,EAAE,UAAU,CAAmB,CAAA;IACpE,IACE,QAAQ,EAAE,kBAAkB,EAAE,qBAAqB;QACnD,QAAQ,EAAE,kBAAkB,EAAE,yBAAyB;QACvD,QAAQ,EAAE,kBAAkB,EAAE,iBAAiB,EAC/C;QACA,OAAO;YACL,oBAAoB,EAAE,QAAQ,EAAE,kBAAkB,EAAE,qBAAqB;YACzE,0BAA0B,EAAE,QAAQ,EAAE,kBAAkB,EAAE,yBAAyB;YACnF,eAAe,EAAE,QAAQ,EAAE,kBAAkB,EAAE,iBAAiB;SACjE,CAAA;KACF;IACD,OAAO,EAAE,CAAA;AACX,CAAC;AAED,SAAS,4CAA4C,CAAC,OAAe;IACnE,MAAM,kBAAkB,GAAG,YAAY,CAAC,OAAO,EAAE,sBAAsB,CAAW,CAAA;IAClF,MAAM,uBAAuB,GAAG,YAAY,CAAC,OAAO,EAAE,4BAA4B,CAAW,CAAA;IAC7F,MAAM,aAAa,GAAG,YAAY,CAAC,OAAO,EAAE,iBAAiB,CAAW,CAAA;IAExE,IAAI,kBAAkB,EAAE,MAAM,GAAG,CAAC,IAAI,uBAAuB,EAAE,MAAM,GAAG,CAAC,IAAI,aAAa,EAAE,MAAM,GAAG,CAAC,EAAE;QACtG,OAAO;YACL,QAAQ,EAAE;gBACR,kBAAkB,EAAE;oBAClB,GAAG,CAAC,kBAAkB,EAAE,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,EAAC,qBAAqB,EAAE,kBAAkB,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC;oBACtF,GAAG,CAAC,uBAAuB,EAAE,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,EAAC,yBAAyB,EAAE,uBAAuB,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC;oBACpG,GAAG,CAAC,aAAa,EAAE,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,EAAC,iBAAiB,EAAE,aAAa,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC;iBACzE;aACF;SACF,CAAA;KACF;IACD,OAAO,EAAE,CAAA;AACX,CAAC","sourcesContent":["import {WebhookSchema} from './app_config_webhook.js'\nimport {WebhooksConfig} from './types/app_config_webhook.js'\nimport {CustomTransformationConfig, createConfigExtensionSpecification} from '../specification.js'\nimport {getPathValue} from '@shopify/cli-kit/common/object'\n\nconst PrivacyComplianceWebbhooksTransformConfig: CustomTransformationConfig = {\n  forward: (content: object) => transformToPrivacyComplianceWebhooksModule(content),\n  reverse: (content: object) => transformFromPrivacyComplianceWebhooksModule(content),\n}\n\nexport const PrivacyComplianceWebbhooksSpecIdentifier = 'privacy_compliance_webhooks'\n\n// Uses the same schema as the webhooks specs because its content is nested under the same webhooks section\nconst spec = createConfigExtensionSpecification({\n  identifier: PrivacyComplianceWebbhooksSpecIdentifier,\n  schema: WebhookSchema,\n  transformConfig: PrivacyComplianceWebbhooksTransformConfig,\n})\n\nexport default spec\n\nfunction transformToPrivacyComplianceWebhooksModule(content: object) {\n  const webhooks = getPathValue(content, 'webhooks') as WebhooksConfig\n  if (\n    webhooks?.privacy_compliance?.customer_deletion_url ||\n    webhooks?.privacy_compliance?.customer_data_request_url ||\n    webhooks?.privacy_compliance?.shop_deletion_url\n  ) {\n    return {\n      customers_redact_url: webhooks?.privacy_compliance?.customer_deletion_url,\n      customers_data_request_url: webhooks?.privacy_compliance?.customer_data_request_url,\n      shop_redact_url: webhooks?.privacy_compliance?.shop_deletion_url,\n    }\n  }\n  return {}\n}\n\nfunction transformFromPrivacyComplianceWebhooksModule(content: object) {\n  const customersRedactUrl = getPathValue(content, 'customers_redact_url') as string\n  const customersDataRequestUrl = getPathValue(content, 'customers_data_request_url') as string\n  const shopRedactUrl = getPathValue(content, 'shop_redact_url') as string\n\n  if (customersRedactUrl?.length > 0 || customersDataRequestUrl?.length > 0 || shopRedactUrl?.length > 0) {\n    return {\n      webhooks: {\n        privacy_compliance: {\n          ...(customersRedactUrl?.length > 0 ? {customer_deletion_url: customersRedactUrl} : {}),\n          ...(customersDataRequestUrl?.length > 0 ? {customer_data_request_url: customersDataRequestUrl} : {}),\n          ...(shopRedactUrl?.length > 0 ? {shop_deletion_url: shopRedactUrl} : {}),\n        },\n      },\n    }\n  }\n  return {}\n}\n"]}