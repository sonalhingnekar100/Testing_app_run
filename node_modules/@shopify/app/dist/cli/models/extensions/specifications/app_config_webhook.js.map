{"version":3,"file":"app_config_webhook.js","sourceRoot":"","sources":["../../../../../src/cli/models/extensions/specifications/app_config_webhook.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,wBAAwB,EAAE,sBAAsB,EAAC,MAAM,mCAAmC,CAAA;AAClG,OAAO,EAAC,aAAa,EAAE,mBAAmB,EAAC,MAAM,wBAAwB,CAAA;AACzE,OAAO,EAAC,gBAAgB,EAAC,MAAM,oCAAoC,CAAA;AACnE,OAAO,EAA6B,kCAAkC,EAAC,MAAM,qBAAqB,CAAA;AAClG,OAAO,EAAC,GAAG,EAAC,MAAM,8BAA8B,CAAA;AAEhD,MAAM,yBAAyB,GAAG,GAAG,CAAC,MAAM,CAAC;IAC3C,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;IAC1C,GAAG,EAAE,GAAG,CAAC,UAAU,CAAC,mBAAmB,EAAE,aAAa,CAAC;IACvD,SAAS,EAAE,GAAG,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAClC,cAAc,EAAE,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;IAClD,oBAAoB,EAAE,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;IACxD,iBAAiB,EAAE,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,kBAAkB,EAAE,wBAAwB,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE;CACjH,CAAC,CAAA;AAEF,MAAM,cAAc,GAAG,GAAG,CAAC,MAAM,CAAC;IAChC,WAAW,EAAE,GAAG,CAAC,MAAM,EAAE;IACzB,kBAAkB,EAAE,GAAG;SACpB,MAAM,CAAC;QACN,qBAAqB,EAAE,aAAa,CAAC,QAAQ,EAAE;QAC/C,yBAAyB,EAAE,aAAa,CAAC,QAAQ,EAAE;QACnD,iBAAiB,EAAE,aAAa,CAAC,QAAQ,EAAE;KAC5C,CAAC;SACD,QAAQ,EAAE;IACb,aAAa,EAAE,GAAG,CAAC,KAAK,CAAC,yBAAyB,CAAC,CAAC,QAAQ,EAAE;CAC/D,CAAC,CAAA;AAEF,MAAM,CAAC,MAAM,6BAA6B,GAAG,cAAc,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAA;AAEzF,MAAM,CAAC,MAAM,aAAa,GAAG,GAAG,CAAC,MAAM,CAAC;IACtC,QAAQ,EAAE,6BAA6B;CACxC,CAAC,CAAA;AAEF,MAAM,CAAC,MAAM,sBAAsB,GAAG,UAAU,CAAA;AAEhD,MAAM,sBAAsB,GAA+B;IACzD,OAAO,EAAE,CAAC,OAAe,EAAE,EAAE,CAAC,sBAAsB,CAAC,OAAO,CAAC;IAC7D,OAAO,EAAE,CAAC,OAAe,EAAE,EAAE,CAAC,wBAAwB,CAAC,OAAO,CAAC;CAChE,CAAA;AAED,MAAM,IAAI,GAAG,kCAAkC,CAAC;IAC9C,UAAU,EAAE,sBAAsB;IAClC,MAAM,EAAE,aAAa;IACrB,eAAe,EAAE,sBAAsB;CACxC,CAAC,CAAA;AAEF,eAAe,IAAI,CAAA","sourcesContent":["import {transformToWebhookConfig, transformWebhookConfig} from './transform/app_config_webhook.js'\nimport {UriValidation, removeTrailingSlash} from './validation/common.js'\nimport {webhookValidator} from './validation/app_config_webhook.js'\nimport {CustomTransformationConfig, createConfigExtensionSpecification} from '../specification.js'\nimport {zod} from '@shopify/cli-kit/node/schema'\n\nconst WebhookSubscriptionSchema = zod.object({\n  topics: zod.array(zod.string()).nonempty(),\n  uri: zod.preprocess(removeTrailingSlash, UriValidation),\n  sub_topic: zod.string().optional(),\n  include_fields: zod.array(zod.string()).optional(),\n  metafield_namespaces: zod.array(zod.string()).optional(),\n  compliance_topics: zod.array(zod.enum(['customers/redact', 'customers/data_request', 'shop/redact'])).optional(),\n})\n\nconst WebhooksSchema = zod.object({\n  api_version: zod.string(),\n  privacy_compliance: zod\n    .object({\n      customer_deletion_url: UriValidation.optional(),\n      customer_data_request_url: UriValidation.optional(),\n      shop_deletion_url: UriValidation.optional(),\n    })\n    .optional(),\n  subscriptions: zod.array(WebhookSubscriptionSchema).optional(),\n})\n\nexport const WebhooksSchemaWithDeclarative = WebhooksSchema.superRefine(webhookValidator)\n\nexport const WebhookSchema = zod.object({\n  webhooks: WebhooksSchemaWithDeclarative,\n})\n\nexport const WebhooksSpecIdentifier = 'webhooks'\n\nconst WebhookTransformConfig: CustomTransformationConfig = {\n  forward: (content: object) => transformWebhookConfig(content),\n  reverse: (content: object) => transformToWebhookConfig(content),\n}\n\nconst spec = createConfigExtensionSpecification({\n  identifier: WebhooksSpecIdentifier,\n  schema: WebhookSchema,\n  transformConfig: WebhookTransformConfig,\n})\n\nexport default spec\n"]}