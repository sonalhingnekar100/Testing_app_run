{"version":3,"file":"load-specifications.js","sourceRoot":"","sources":["../../../../src/cli/models/extensions/load-specifications.ts"],"names":[],"mappings":"AACA,OAAO,EAAC,qBAAqB,EAAC,MAAM,yCAAyC,CAAA;AAC7E,OAAO,EAAC,sBAAsB,EAAC,MAAM,0CAA0C,CAAA;AAC/E,OAAO,EAAC,iBAAiB,EAAC,MAAM,8CAA8C,CAAA;AAC9E,OAAO,EAAC,sBAAsB,EAAC,MAAM,wCAAwC,CAAA;AAC7E,OAAO,EAAC,sBAAsB,EAAC,MAAM,yCAAyC,CAAA;AAC9E,OAAO,EAAC,uBAAuB,EAAC,MAAM,2CAA2C,CAAA;AACjF,OAAO,EAAC,wCAAwC,EAAC,MAAM,4DAA4D,CAAA;AACnH,OAAO,EAAC,eAAe,EAAC,MAAM,0BAA0B,CAAA;AACxD,OAAO,EAAC,OAAO,EAAC,MAAM,kCAAkC,CAAA;AACxD,OAAO,EAAC,QAAQ,EAAE,OAAO,EAAC,MAAM,4BAA4B,CAAA;AAC5D,OAAO,EAAC,IAAI,EAAC,MAAM,0BAA0B,CAAA;AAC7C,OAAO,EAAC,aAAa,EAAC,MAAM,KAAK,CAAA;AAEjC,MAAM,qCAAqC,GAAG;IAC5C,sBAAsB;IACtB,uBAAuB;IACvB,sBAAsB;IACtB,wCAAwC;IACxC,sBAAsB;IACtB,iBAAiB;IACjB,qBAAqB;CACtB,CAAA;AAED;;GAEG;AACH,MAAM,CAAC,KAAK,UAAU,iCAAiC;IACrD,MAAM,iBAAiB,GAAG,CAAC,KAA6B,EAAE,KAA6B,EAAE,EAAE,CACzF,qCAAqC,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC;QAC/D,qCAAqC,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAA;IACjE,OAAO,CAAC,MAAM,iBAAiB,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAA;AAC5E,CAAC;AAED,MAAM,iBAAiB,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAA;AAErD,KAAK,UAAU,kBAAkB,CAAC,aAAqB;IACrD;;;;OAIG;IACH,MAAM,GAAG,GAAG,QAAQ,CAAC,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,QAAQ,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC,CAAA;IACnG,IAAI,KAAK,GAAG,MAAM,IAAI,CAAC,GAAG,EAAE,EAAC,MAAM,EAAE,CAAC,SAAS,EAAE,YAAY,CAAC,EAAC,CAAC,CAAA;IAEhE,0DAA0D;IAC1D,MAAM,EAAC,QAAQ,EAAC,GAAG,eAAe,EAAE,CAAA;IACpC,IAAI,QAAQ,KAAK,SAAS,EAAE;QAC1B,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,UAAU,IAAI,EAAE,CAAC,CAAA;KAC9C;IAED,MAAM,QAAQ,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAA;IAClD,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;IAC3C,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,CAAA;IACrD,OAAO,KAAK,CAAA;AACd,CAAC","sourcesContent":["import {ExtensionSpecification} from './specification.js'\nimport {AppHomeSpecIdentifier} from './specifications/app_config_app_home.js'\nimport {AppProxySpecIdentifier} from './specifications/app_config_app_proxy.js'\nimport {PosSpecIdentifier} from './specifications/app_config_point_of_sale.js'\nimport {WebhooksSpecIdentifier} from './specifications/app_config_webhook.js'\nimport {BrandingSpecIdentifier} from './specifications/app_config_branding.js'\nimport {AppAccessSpecIdentifier} from './specifications/app_config_app_access.js'\nimport {PrivacyComplianceWebbhooksSpecIdentifier} from './specifications/app_config_privacy_compliance_webhooks.js'\nimport {platformAndArch} from '@shopify/cli-kit/node/os'\nimport {memoize} from '@shopify/cli-kit/common/function'\nimport {joinPath, dirname} from '@shopify/cli-kit/node/path'\nimport {glob} from '@shopify/cli-kit/node/fs'\nimport {fileURLToPath} from 'url'\n\nconst SORTED_CONFIGURATION_SPEC_IDENTIFIERS = [\n  BrandingSpecIdentifier,\n  AppAccessSpecIdentifier,\n  WebhooksSpecIdentifier,\n  PrivacyComplianceWebbhooksSpecIdentifier,\n  AppProxySpecIdentifier,\n  PosSpecIdentifier,\n  AppHomeSpecIdentifier,\n]\n\n/**\n * Load all specifications ONLY from the local file system\n */\nexport async function loadLocalExtensionsSpecifications(): Promise<ExtensionSpecification[]> {\n  const sortConfigModules = (specA: ExtensionSpecification, specB: ExtensionSpecification) =>\n    SORTED_CONFIGURATION_SPEC_IDENTIFIERS.indexOf(specA.identifier) -\n    SORTED_CONFIGURATION_SPEC_IDENTIFIERS.indexOf(specB.identifier)\n  return (await memoizedLoadSpecs('specifications')).sort(sortConfigModules)\n}\n\nconst memoizedLoadSpecs = memoize(loadSpecifications)\n\nasync function loadSpecifications(directoryName: string) {\n  /**\n   * When running tests, \"await import('.../spec..ts')\" is handled by Vitest which does\n   * transform the TS module into a JS one before loading it. Hence the inclusion of .ts\n   * in the list of files.\n   */\n  const url = joinPath(dirname(fileURLToPath(import.meta.url)), joinPath(directoryName, '*.{js,ts}'))\n  let files = await glob(url, {ignore: ['**.d.ts', '**.test.ts']})\n\n  // From Node 18, all windows paths must start with file://\n  const {platform} = platformAndArch()\n  if (platform === 'windows') {\n    files = files.map((file) => `file://${file}`)\n  }\n\n  const promises = files.map((file) => import(file))\n  const modules = await Promise.all(promises)\n  const specs = modules.map((module) => module.default)\n  return specs\n}\n"]}